# Default values for happy-little-claude-coders
# This chart supports multiple independent Claude Code workspaces in a single HelmRelease

image:
  repository: ghcr.io/yourorg/happy-little-claude-coders
  pullPolicy: IfNotPresent
  tag: "0.4.0"  # x-release-please-version

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Multiple workspaces configuration
# Each workspace gets its own pod/deployment with dedicated PVCs
workspaces:
  - name: example
    # List of repositories to clone for this workspace
    repos:
      - "https://github.com/slopus/happy-cli.git"
    # Storage size for workspace files (emptyDir or PVC)
    storageSize: 10Gi
    # Use persistent storage (PVC) instead of emptyDir
    persistent: false
    # Optional: Override default resources for this workspace
    # resources:
    #   limits:
    #     cpu: 2000m
    #     memory: 4Gi
    #   requests:
    #     cpu: 500m
    #     memory: 1Gi

# Global git identity configuration (applies to all workspaces)
git:
  userName: "Claude Bot"
  userEmail: "claude-bot@example.com"

# Global GitHub authentication settings
github:
  # PVC size for ~/.config/gh/ persistence per workspace
  configPvcSize: 100Mi
  # Optional: Name of secret containing GitHub token for private repos
  # Secret should have a 'token' key with the GitHub personal access token
  tokenSecretName: ""

# GitHub App authentication (alternative to interactive auth)
githubApp:
  # Enable GitHub App authentication with automatic token refresh
  enabled: false
  # Name of secret containing GitHub App credentials
  # Secret must have keys: app-id, installation-id, private-key
  # See history/GITHUB_APP_SETUP_GUIDE.md for setup instructions
  secretName: ""
  # Token refresh interval in minutes (tokens expire after 60 minutes)
  # Recommended: 45 minutes (refresh before expiration)
  refreshIntervalMinutes: 45
  # Sidecar container image for token refresh
  # Uses official ghinstallation library for token generation
  sidecarImage: ghcr.io/yourorg/github-token-sidecar:latest

# Global Claude Code authentication settings
claude:
  # Name of secret containing CLAUDE_CODE_OAUTH_TOKEN
  # If empty, you must create the secret manually
  secretName: ""
  # PVC size for ~/.claude/ persistence per workspace
  configPvcSize: 100Mi

# Default resource limits and requests for workspaces
# Can be overridden per workspace in workspaces[].resources
resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

# Security context for pods (applies to all containers)
# Following Bitnami pattern with UID/GID 1001
podSecurityContext:
  enabled: true
  fsGroup: 1001
  runAsUser: 1001
  runAsGroup: 1001
  runAsNonRoot: true

# Security context for main workspace containers
containerSecurityContext:
  enabled: true
  runAsUser: 1001
  runAsGroup: 1001
  runAsNonRoot: true
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false  # Need write access to /tmp and other locations
  capabilities:
    drop:
    - ALL

# Security context for init containers (clone-repos)
# Must match pod-level settings for proper file permissions
initContainerSecurityContext:
  enabled: true
  runAsUser: 1001
  runAsGroup: 1001
  runAsNonRoot: true
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false  # git clone needs write access
  capabilities:
    drop:
    - ALL

nodeSelector: {}

tolerations: []

affinity: {}

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""
